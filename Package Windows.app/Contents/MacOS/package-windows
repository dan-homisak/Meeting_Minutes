#!/bin/bash

set -euo pipefail

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "${SCRIPT_DIR}/../../.." && pwd)"
LOG_FILE="${PROJECT_ROOT}/package-windows.log"

escape_applescript() {
  printf '%s' "$1" | sed 's/\\/\\\\/g; s/"/\\"/g'
}

inform() {
  local message
  message=$(escape_applescript "$1")
  /usr/bin/osascript <<EOF
display dialog "$message" buttons {"OK"} default button "OK" with title "Package Windows"
EOF
}

cat <<'EOF' >"${LOG_FILE}"
PyInstaller is required to package the Windows executable and must run on a Windows machine.

Steps:
1. Ensure Python 3.10+ is installed on Windows.
2. From this project directory, create the virtual environment:
       scripts\setup.ps1
3. Activate the environment and install PyInstaller:
       .\.venv\Scripts\Activate.ps1
       python -m pip install pyinstaller
4. Package the application:
       python -m PyInstaller run.py --onefile --noconsole --name SkeletonApp ^
           --add-data "backend;backend" --add-data "frontend/static;frontend/static"
5. The finished executable appears in the dist\ folder.

Future releases: rerun step 3 after updating the code.
EOF

inform "Packaging for Windows needs to happen on a Windows machine. Full instructions are in package-windows.log."
